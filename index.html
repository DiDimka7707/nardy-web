<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>–ù–∞—Ä–¥—ã –ö–ª–∞—Å—Å–∏–∫–∞ ¬∑ v1.0</title>
  <meta name="color-scheme" content="dark light"/>
  <!-- Three.js -->
  <script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>
  <!-- –ú–∏–Ω–∏–º—É–º —Å—Ç–∏–ª–∏–π (—Ñ–ª–∞–≥–º–∞–Ω—Å–∫–∏–π —Ç—ë–º–Ω—ã–π) -->
  <style>
    :root{--bg:#0e1116;--card:#171b22;--muted:#8b95a7;--text:#e8eefc;--border:rgba(255,255,255,.08);
          --primary:#4da3ff;--primary2:#6a7bff;--ring:0 0 0 2px rgba(77,163,255,.35),0 8px 20px rgba(77,163,255,.25);
          --radius:16px;}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:radial-gradient(1000px 600px at 50% -120px,#1b2230 0%,var(--bg) 60%);
         color:var(--text);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
         -webkit-tap-highlight-color:transparent;}
    .app{min-height:100dvh;padding-bottom:96px}
    header{position:sticky;top:0;z-index:10;display:flex;justify-content:space-between;align-items:center;
           padding:14px 16px calc(14px + env(safe-area-inset-top));
           background:linear-gradient(180deg,rgba(10,12,18,.85),rgba(10,12,18,0));
           backdrop-filter:blur(10px)}
    .title{font-weight:800;font-size:20px}
    .balance{display:flex;gap:8px;align-items:center;background:linear-gradient(135deg,rgba(77,163,255,.2),rgba(106,123,255,.2));
             border:1px solid var(--border);padding:8px 12px;border-radius:999px}
    .coin{width:20px;height:20px;border-radius:50%;background:radial-gradient(circle at 30% 30%,#fff2a1,#ffd05a 40%,#ffb800 70%,#ef9f00 100%);
          box-shadow:0 1px 0 #fff8, inset 0 0 4px #0006}
    main{padding:12px 14px 24px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01)); border:1px solid var(--border);
          border-radius:var(--radius); padding:18px; box-shadow:0 10px 40px rgba(0,0,0,.25)}
    h2{margin:0 0 8px;font-size:26px} p.muted{color:var(--muted);margin:0 0 10px;font-size:14px}
    .btn{width:100%;padding:14px 16px;border-radius:14px;border:none;color:#fff;font-weight:800;font-size:16px;cursor:pointer;user-select:none}
    .btn.primary{background:linear-gradient(135deg,var(--primary),var(--primary2));box-shadow:var(--ring)}
    .btn.secondary{background:linear-gradient(135deg,#2a3140,#222a36);color:#dbe7ff;border:1px solid var(--border)}
    .btn.ghost{background:transparent;color:#c9d6ff;border:1px dashed rgba(255,255,255,.25)}
    .btn:disabled{opacity:.6} .spacer{height:12px} .space{height:16px}
    .row{display:flex;gap:12px} .col{flex:1}
    .screen{display:none} .screen.active{display:block}
    nav.tabbar{position:fixed;left:0;right:0;bottom:0;z-index:20;display:flex;gap:10px;justify-content:space-between;
               padding:10px 10px calc(10px + env(safe-area-inset-bottom));
               background:linear-gradient(180deg,rgba(10,12,18,0),rgba(10,12,18,.85) 30%,rgba(10,12,18,.95));
               backdrop-filter:blur(12px); border-top:1px solid var(--border)}
    .tab{flex:1;padding:10px 8px;border-radius:14px;border:1px solid var(--border);
         background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));
         color:#c9d6ff;font-weight:800;font-size:14px;display:flex;gap:8px;align-items:center;justify-content:center}
    .tab.active{color:#fff;box-shadow:var(--ring);outline:1px solid rgba(77,163,255,.45)}

    /* sheet */
    .sheet{position:fixed;inset:0;z-index:40;display:none}
    .sheet.open{display:block}
    .sheet .backdrop{position:absolute;inset:0;background:#0009;backdrop-filter:blur(2px)}
    .sheet .panel{position:absolute;left:0;right:0;bottom:0;border-radius:24px 24px 0 0;background:linear-gradient(180deg,#141923,#0f151f);
                  border:1px solid rgba(255,255,255,.08);padding:16px 14px calc(18px + env(safe-area-inset-bottom));
                  box-shadow:0 -20px 60px rgba(0,0,0,.45);animation:slideUp .22s ease both}
    @keyframes slideUp{from{transform:translateY(30px);opacity:0}to{transform:translateY(0);opacity:1}}
    .sheet .handle{width:44px;height:5px;border-radius:6px;background:#394150;margin:0 auto 12px}
    .input{width:100%;padding:14px;border-radius:12px;background:#0d131c;color:#eaf1ff;border:1px solid #243046;font-size:16px}
    .input::placeholder{color:#789}
    .legal{display:inline-block;padding:2px 8px;border-radius:999px;background:#2a3140;color:#cfe0ff;border:1px solid #3c4a66;font-size:12px}
    canvas#game3d{width:100%;height:360px;display:block;border-radius:14px;border:1px solid var(--border);background:#0b0f16}
    .donate-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="title">–ù–∞—Ä–¥—ã –ö–ª–∞—Å—Å–∏–∫–∞</div>
      <div class="balance"><div class="coin"></div><strong id="balance">0</strong></div>
    </header>

    <main>
      <!-- Games -->
      <section id="screen-games" class="screen active" data-screen="games">
        <div class="card">
          <h2>–ò–≥—Ä—ã</h2>
          <p class="muted">–°–æ–∑–¥–∞–π –∫–æ–º–Ω–∞—Ç—É –∏–ª–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Å—å –∫ –¥—Ä—É–≥—É. –ü–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ –ø–æ—è–≤–∏—Ç—Å—è 3D-–¥–æ—Å–∫–∞.</p>
          <div class="spacer"></div>
          <button id="btn-create" class="btn primary">üé≤ –°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É</button>
          <div class="spacer"></div>
          <button id="btn-join" class="btn secondary">üîó –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
        </div>
        <div class="spacer"></div>
        <div class="card">
          <h2>3D-–¥–æ—Å–∫–∞ (–¥–µ–º–æ)</h2>
          <p class="muted">–ù–∞–∂–º–∏ ¬´–ë—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫–∏¬ª. –î–≤–∏–∂–∫–∏ –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞—é—Ç –ª–µ–≥–∞–ª—å–Ω—ã–µ —Ö–æ–¥—ã (MVP).</p>
          <canvas id="game3d" width="800" height="360"></canvas>
          <div class="space"></div>
          <div class="row">
            <button id="btn-start" class="btn secondary">üö¶ –°—Ç–∞—Ä—Ç –º–∞—Ç—á–∞</button>
            <button id="btn-roll"  class="btn primary">üé≤ –ë—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫–∏</button>
          </div>
          <div class="spacer"></div>
          <div id="movesHint" class="legal" style="display:none"></div>
        </div>
      </section>

      <!-- Profile -->
      <section id="screen-profile" class="screen" data-screen="profile">
        <div class="card">
          <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
          <div class="space"></div>
          <input id="profileName" class="input" placeholder="–ò–º—è"/>
          <div class="spacer"></div>
          <input id="profileNick" class="input" placeholder="–ù–∏–∫–Ω–µ–π–º"/>
          <div class="space"></div>
          <button id="btn-save" class="btn primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
      </section>

      <!-- Themes -->
      <section id="screen-themes" class="screen" data-screen="themes">
        <div class="card">
          <h2>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</h2>
          <p class="muted">–°–∫–∏–Ω—ã –¥–æ—Å–∫–∏ –∏ –∫–æ—Å—Ç–µ–π ‚Äî —Å–∫–æ—Ä–æ.</p>
          <button class="btn ghost" disabled>–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</button>
        </div>
      </section>

      <!-- Donate -->
      <section id="screen-donate" class="screen" data-screen="donate">
        <div class="card">
          <h2>–î–æ–Ω–∞—Ç</h2>
          <p class="muted">–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –∑–∞—á–∏—Å–ª–∏–º –º–æ–Ω–µ—Ç—ã (–¥–µ–º–æ). –¶–µ–Ω—ã:</p>
          <div class="space"></div>
          <div class="donate-grid" id="donateGrid"></div>
          <div class="space"></div>
          <button id="btn-donate-custom" class="btn secondary">–ü–æ–ø–æ–ª–Ω–∏—Ç—å –Ω–∞ –¥—Ä—É–≥—É—é —Å—É–º–º—É‚Ä¶</button>
        </div>
      </section>
    </main>

    <nav class="tabbar">
      <button class="tab active" data-tab="games">üéÆ –ò–≥—Ä—ã</button>
      <button class="tab" data-tab="profile">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
      <button class="tab" data-tab="themes">üé® –û—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</button>
      <button class="tab" data-tab="donate">üíé –î–æ–Ω–∞—Ç</button>
    </nav>
  </div>

  <!-- Join Sheet -->
  <div id="join-sheet" class="sheet" aria-hidden="true">
    <div class="backdrop" id="join-close"></div>
    <div class="panel">
      <div class="handle"></div>
      <h2 style="margin:0 0 8px">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</h2>
      <div class="space"></div>
      <div class="card" style="padding:14px">
        <h3 style="margin:0 0 8px;font-size:18px">–ü–æ –∫–æ–¥—É –∫–æ–º–Ω–∞—Ç—ã</h3>
        <input id="joinCodeInput" class="input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 7B7FX" maxlength="8"/>
        <div class="spacer"></div>
        <button id="btn-join-go" class="btn primary">–í–æ–π—Ç–∏</button>
      </div>
      <div class="space"></div>
      <button id="join-cancel" class="btn ghost">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>

  <script>
  // ====== –ù–ê–°–¢–†–û–ô–ö–ê API (–ü–û–°–¢–ê–í–¨ –°–í–û–ô –î–û–ú–ï–ù) ======
  const API_BASE = 'https://YOUR-KOYEB-APP-DOMAIN.koyeb.app'; // <-- –ó–ê–ú–ï–ù–ò –Ω–∞ —Å–≤–æ–π Public URL!
  const TG = window.Telegram?.WebApp; try{TG?.expand?.()}catch{}

  // ====== –£—Ç–∏–ª–∏—Ç—ã ======
  const $ = (s,r=document)=>r.querySelector(s);
  const $$= (s,r=document)=>Array.from(r.querySelectorAll(s));
  const api = async (p, m='GET', b=null)=>{
    const res = await fetch(API_BASE.replace(/\\/+$/,'')+p, {
      method:m, headers:{'Content-Type':'application/json'},
      body: b? JSON.stringify(b): null
    });
    if(!res.ok){ let msg='HTTP '+res.status; try{const j=await res.json(); if(j.detail) msg=j.detail;}catch{}; throw new Error(msg); }
    const ct=res.headers.get('content-type')||''; return ct.includes('application/json')? res.json(): res.text();
  };
  function pop(msg){ if(TG?.showPopup) TG.showPopup({title:'–°–æ–æ–±—â–µ–Ω–∏–µ', message:msg, buttons:[{type:'ok'}]}); else alert(msg); }
  function haptic(type='impact'){ try{ TG?.HapticFeedback?.impactOccurred?.(type); }catch{} }
  function setBusy(btn,on,text){ if(!btn)return; if(!btn.__t) btn.__t=btn.textContent; btn.disabled=!!on; btn.textContent = on?(text||'–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶'):btn.__t; }

  // ====== –ù–∞–≤–∏–≥–∞—Ü–∏—è (—Ç–∞–±—ã) ======
  function show(tab){ $$('.screen').forEach(s=>s.classList.remove('active')); $('#screen-'+tab).classList.add('active');
    $$('.tab').forEach(b=>b.classList.toggle('active', b.dataset.tab===tab)); }
  $$('.tab').forEach(b=> b.addEventListener('click', ()=> show(b.dataset.tab)));

  // ====== –ë–∞–ª–∞–Ω—Å/–¥–æ–Ω–∞—Ç ======
  const donatePrices = [
    {coins:50, usd:0.50},{coins:100,usd:0.99},{coins:200,usd:1.99},{coins:500,usd:2.99},{coins:1000,usd:4.99}
  ];
  async function refreshBalance(){
    const pid = TG?.initDataUnsafe?.user?.id?.toString() || 'guest';
    try{ const r = await api('/api/balance?player_id='+encodeURIComponent(pid)); $('#balance').textContent = r.balance; }
    catch{ /* ignore */ }
  }
  function buildDonate(){
    const grid = $('#donateGrid'); grid.innerHTML = '';
    donatePrices.forEach(p=>{
      const btn = document.createElement('button');
      btn.className='btn secondary';
      btn.textContent = `+${p.coins} –º–æ–Ω–µ—Ç ‚Ä¢ $${p.usd.toFixed(2)}`;
      btn.addEventListener('click', ()=> donate(p.coins));
      grid.appendChild(btn);
    });
  }
  async function donate(coins){
    const pid = TG?.initDataUnsafe?.user?.id?.toString() || 'guest';
    try{ await api('/api/donate','POST',{player_id:pid, coins}); haptic('heavy'); await refreshBalance(); pop('–°–ø–∞—Å–∏–±–æ! +' + coins + ' –º–æ–Ω–µ—Ç'); }
    catch(e){ pop('–û—à–∏–±–∫–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è: ' + e.message); }
  }

  // ====== –ö–æ–º–Ω–∞—Ç—ã/–º–∞—Ç—á ======
  let currentCode = null;
  let myRole = null;
  let waitTimer = null;

  $('#btn-create').addEventListener('click', async ()=>{
    setBusy($('#btn-create'), true, '–°–æ–∑–¥–∞—ë–º‚Ä¶');
    try{
      const r = await api('/api/rooms/create', 'POST');
      currentCode = r.code; myRole='A'; haptic('rigid');
      pop('–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã: ' + currentCode);
      // –∂–¥—ë–º —Å–æ–ø–µ—Ä–Ω–∏–∫–∞
      clearInterval(waitTimer);
      waitTimer = setInterval(async ()=>{
        try{
          const st = await api('/api/rooms/'+currentCode+'/status');
          if(st.status==='ready'){ clearInterval(waitTimer); waitTimer=null; pop('–°–æ–ø–µ—Ä–Ω–∏–∫ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è! –ù–∞–∂–º–∏ ¬´–°—Ç–∞—Ä—Ç –º–∞—Ç—á–∞¬ª.'); }
        }catch{ /* ignore */ }
      }, 2000);
    }catch(e){ pop('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å: ' + e.message); }
    finally{ setBusy($('#btn-create'), false); }
  });

  $('#btn-join').addEventListener('click', ()=> $('#join-sheet').classList.add('open'));
  $('#join-close').addEventListener('click', ()=> $('#join-sheet').classList.remove('open'));
  $('#join-cancel').addEventListener('click', ()=> $('#join-sheet').classList.remove('open'));

  $('#btn-join-go').addEventListener('click', async ()=>{
    const code = ($('#joinCodeInput').value||'').trim().toUpperCase();
    if(!code) return pop('–í–≤–µ–¥–∏ –∫–æ–¥ –∫–æ–º–Ω–∞—Ç—ã');
    setBusy($('#btn-join-go'), true, '–í—Ö–æ–¥–∏–º‚Ä¶');
    try{
      const pid = TG?.initDataUnsafe?.user?.id?.toString() || '';
      const name= $('#profileName')?.value || TG?.initDataUnsafe?.user?.first_name || '–ò–≥—Ä–æ–∫';
      const nick= $('#profileNick')?.value || TG?.initDataUnsafe?.user?.username || '';
      const r = await api('/api/rooms/'+code+'/join','POST',{player_id:pid,name, nick});
      currentCode = code; myRole = r.role; haptic('soft'); $('#join-sheet').classList.remove('open'); pop('–ì–æ—Ç–æ–≤–æ! –ö–æ–¥: '+code);
    }catch(e){ pop('–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ–π—Ç–∏: '+e.message); }
    finally{ setBusy($('#btn-join-go'), false); }
  });

  $('#btn-start').addEventListener('click', async ()=>{
    if(!currentCode) return pop('–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π –∫–æ–º–Ω–∞—Ç—É –∏–ª–∏ –≤–æ–π–¥–∏ –ø–æ –∫–æ–¥—É');
    try{
      const st = await api('/api/game/'+currentCode+'/start','POST');
      game.setBoard(st.state.board); game.turn = st.state.turn;
      pop('–°—Ç–∞—Ä—Ç! –•–æ–¥: ' + (game.turn==='A'?'–ë–µ–ª—ã–µ (A)':'–ß—ë—Ä–Ω—ã–µ (B)'));
    }catch(e){ pop('–°—Ç–∞—Ä—Ç –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω: '+e.message); }
  });

  $('#btn-roll').addEventListener('click', async ()=>{
    if(!currentCode) return pop('–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –∫–æ–º–Ω–∞—Ç—ã');
    if(!myRole) return pop('–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Ä–æ–ª—å –∏–≥—Ä–æ–∫–∞');
    try{
      const r = await api('/api/game/'+currentCode+'/roll','POST',{role: myRole});
      haptic('heavy'); game.animateDice(r.dice); game.showHints(); // –ø–æ–¥—Å–∫–∞–∑–∫–∏ —Ö–æ–¥–æ–≤ (MVP)
    }catch(e){ pop('–ù–µ–ª—å–∑—è –±—Ä–æ—Å–∏—Ç—å: ' + e.message); }
  });

  // ====== 3D –î–æ—Å–∫–∞ + –ö—É–±–∏–∫–∏ (MVP) ======
  const game = (function(){
    const canvas = document.getElementById('game3d');
    const scene = new THREE.Scene();
    const renderer = new THREE.WebGLRenderer({canvas, antialias:true, alpha:true});
    const camera = new THREE.PerspectiveCamera(40, canvas.width/canvas.height, 0.1, 100);
    camera.position.set(0, 7, 9); camera.lookAt(0,0,0);

    const light = new THREE.DirectionalLight(0xffffff, 1.0); light.position.set(5,10,7); scene.add(light);
    scene.add(new THREE.AmbientLight(0xffffff, .45));

    // Board (simple wood plane)
    const boardGeo = new THREE.BoxGeometry(10, 0.4, 6);
    const boardMat = new THREE.MeshStandardMaterial({color:0x3a2a21, roughness:.8, metalness:.1});
    const board = new THREE.Mesh(boardGeo, boardMat); board.position.y = -0.2; scene.add(board);

    // Checkers (circles on top) ‚Äì visual demo only
    const checkerGeo = new THREE.CylinderGeometry(0.25, 0.25, 0.12, 32);
    const matA = new THREE.MeshStandardMaterial({color:0xf2f2f2, metalness:.2, roughness:.6});
    const matB = new THREE.MeshStandardMaterial({color:0x111418, metalness:.2, roughness:.6});
    const checkers = []; // store meshes

    // Board model (matches backend): 24 points, A positive to the right->left upper row then lower
    let boardArr = [];     // from backend
    let turn = 'A';
    let diceVals = [];

    function pointToXY(i){ // i: 0..23 -> (x,z)
      // 12 points top (left->right: 12..1), 12 bottom (1..12)
      const w = 4.4, h = 2.2; // half widths
      const gap = 0.4;
      if(i<=11){ // top row, right->left visually
        const idx = 11 - i;
        const x = -w + (idx%6)*( (2*w- gap)/5 ) ;
        const z = -h;
        return [x, z];
      } else { // bottom row, left->right
        const idx = i-12;
        const x = -w + (idx%6)*( (2*w- gap)/5 );
        const z = h;
        return [x, z];
      }
    }

    function rebuildCheckers(){
      // clear old
      checkers.forEach(m=>scene.remove(m));
      checkers.length=0;
      const stacksTop = Array(24).fill(0);
      for(let i=0;i<24;i++){
        const n = Math.abs(boardArr[i]);
        const ownerA = boardArr[i] > 0;
        for(let s=0;s<n;s++){
          const m = new THREE.Mesh(checkerGeo, ownerA?matA:matB);
          const [x,z] = pointToXY(i);
          m.position.set(x, (s*0.13)+0.06, z);
          scene.add(m); checkers.push(m);
        }
      }
      render();
    }

    // Dice
    const dice = [];
    function makeDie(){
      const g = new THREE.BoxGeometry(0.5,0.5,0.5);
      const m = new THREE.MeshStandardMaterial({color:0xffffff, roughness:.5, metalness:.2});
      const cube = new THREE.Mesh(g, m);
      cube.castShadow = true; return cube;
    }
    function animateDice(vals){
      diceVals = vals.slice();
      // remove old
      dice.forEach(d=>scene.remove(d)); dice.length=0;
      // spawn from bottom and arc up
      for(let i=0;i<Math.min(2, vals.length); i++){
        const d = makeDie();
        d.position.set(-2 + i*1.0, -1.5, 3.2); // –Ω–∏–∂–µ —ç–∫—Ä–∞–Ω–∞ (—Å–Ω–∏–∑—É)
        scene.add(d); dice.push(d);
      }
      const t0 = performance.now();
      function tick(){
        const t = (performance.now()-t0)/1000;
        dice.forEach((d,idx)=>{
          d.position.y = Math.min(0.6, -1.5 + t*2.5);
          d.position.x += 0.01 + idx*0.005;
          d.rotation.x += 0.2 + idx*0.1;
          d.rotation.y += 0.3;
        });
        render();
        if(t<1.0) requestAnimationFrame(tick);
      }
      requestAnimationFrame(tick);
    }

    function showHints(){
      // MVP: –ø–æ–¥—Å–∫–∞–∑–∫–∏ = –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –∫—É–±–∏–∫–æ–≤
      const hint = document.getElementById('movesHint');
      hint.style.display='inline-block';
      hint.textContent = '–ö—É–±–∏–∫–∏: ' + (diceVals && diceVals.length ? diceVals.join(' + ') : '‚Äî');
    }

    function setBoard(arr){ boardArr = arr.slice(); rebuildCheckers(); }
    function render(){ renderer.setSize(canvas.clientWidth, canvas.clientHeight, false); renderer.render(scene, camera); }

    // initial
    setBoard(Array(24).fill(0));
    render();

    return { setBoard, animateDice, showHints, get turn(){return turn;}, set turn(v){ turn=v; } };
  })();

  // ====== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ======
  buildDonate(); refreshBalance();
  // –°—Ç–∞—Ä—Ç–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ API
  fetch(API_BASE.replace(/\\/+$/,'')+'/health').catch(()=> pop('API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ. –ü—Ä–æ–≤–µ—Ä—å –¥–æ–º–µ–Ω –≤ index.html ‚Üí API_BASE'));
  </script>
</body>
</html>
